<div class="admin-products-layout">
  <div class="product-creation-preview">
    <div class="creation-form">
      <h3>Crear nuevo producto</h3>

      <input [(ngModel)]="newProduct.name" name="name" placeholder="Nombre del producto" required />
      <textarea [(ngModel)]="newProduct.description" name="description" placeholder="Descripción" rows="3"></textarea>
      <input type="number" [(ngModel)]="newProduct.price" name="price" placeholder="Precio (€)" />
      <input type="number" [(ngModel)]="newProduct.rating" name="rating" step="0.1" min="0" max="5" placeholder="Rating (0.0 - 5.0)" />


      <select [(ngModel)]="newProduct.categoryId" name="categoryId" required>
        <option value="">Seleccionar categoría</option>
        <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
      </select>

      <label for="imageInput">Imagen del producto:</label>
      <input type="file" id="imageInput" (change)="onImageSelected($event)" accept="image/*" class="form-control mb-2" />

      <label>Agregar Ingrediente:</label>
      <div class="row g-2">
        <div class="col-md-9 col-12">
          <select class="form-select" [(ngModel)]="selectedIngredientId">
            <option [ngValue]="''" disabled selected>Selecciona un ingrediente</option>
            <option *ngFor="let ing of availableIngredients()" [value]="ing.id">{{ ing.name }}</option>
          </select>
        </div>
        <div class="col-md-3 col-12">
          <button type="button" class="btn btn-secondary w-100" (click)="addIngredient()">Añadir</button>
        </div>
      </div>

      <div class="selected-ingredients mt-2">
        <span *ngFor="let id of newProduct.ingredientIds" class="ingredient-pill">
          {{ getIngredientName(id) }}
          <button type="button" (click)="removeIngredient(id)">✖</button>
        </span>
      </div>

      <button (click)="crearProducto()">Crear producto</button>
    </div>

    <div class="preview">
      <h4>Previsualización</h4>
      <p><strong>Nombre:</strong> {{ newProduct.name }}</p>
      <p><strong>Descripción:</strong> {{ newProduct.description }}</p>
      <p><strong>Precio:</strong> {{ newProduct.price }} €</p>
      <p><strong>Categoría:</strong> {{ getCategoryName(newProduct.categoryId) }}</p>
      <p><strong>Ingredientes:</strong>
        <span *ngFor="let id of newProduct.ingredientIds">
          {{ getIngredientName(id) }}{{ id !== newProduct.ingredientIds[newProduct.ingredientIds.length - 1] ? ', ' : '' }}
        </span>
      </p>
      <div *ngIf="productImageBase64">
        <p><strong>Imagen cargada:</strong></p>
        <img [src]="productImageBase64" alt="Previsualización" style="max-width: 150px; border-radius: 8px;" />
      </div>
    </div>
  </div>

  <hr />

  <div class="filter-section">
    <input [(ngModel)]="filterName" placeholder="Filtrar por nombre" />
    <select [(ngModel)]="filterCategoryId">
      <option value="">Todas las categorías</option>
      <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
    </select>
  </div>

  <table class="table table-dark table-bordered mt-4">
    <thead>
    <tr>
      <th>Nombre</th>
      <th>Descripción</th>
      <th>Precio</th>
      <th>Categoría</th>
      <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let p of getFilteredProducts()">
      <td>{{ p.name }}</td>
      <td>{{ p.description }}</td>
      <td>{{ p.price }} €</td>
      <td>{{ p.foodCategory?.name }}</td>
      <td><button (click)="eliminarProducto(p.id)" class="btn btn-danger btn-sm">Eliminar</button></td>
    </tr>
    </tbody>
  </table>
</div>
